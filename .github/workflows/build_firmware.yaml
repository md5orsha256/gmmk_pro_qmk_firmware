name: Build QMK Firmware for my GMMK Pro with fix rotary knob
on: [push]
jobs:
  build-malware:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v2
      - name: Install python 3.9
        uses: actions/setup-python@v2
        with:
          python-version: '3.9'
      - name: Install and configure qmk
        run: |
          python3 -m pip install qmk
          export QMK_HOME='~/qmk_firmware'
          qmk setup --yes
          ls -a

      - name: Build c lang firmware
        run: |
          qmk json2c -o dc5f48d9-d7f9-4143-8a2b-86b0a3c620ff-keymap.c gmmk_pro_ansi_layout_mine.json
          ls -lah
          cat dc5f48d9-d7f9-4143-8a2b-86b0a3c620ff-keymap.c
          echo -e "\n"  >> dc5f48d9-d7f9-4143-8a2b-86b0a3c620ff-keymap.c
          echo -e "bool encoder_update_user(uint8_t index, bool clockwise) {\n    if (clockwise) {\n      tap_code(KC_VOLU);\n    } else {\n      tap_code(KC_VOLD);\n    }\n    return true;\n}" >> dc5f48d9-d7f9-4143-8a2b-86b0a3c620ff-keymap.c
          cat dc5f48d9-d7f9-4143-8a2b-86b0a3c620ff-keymap.c
          qmk compile --help
          ls -a